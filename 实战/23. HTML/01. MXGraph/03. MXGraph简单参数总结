å…·ä½“æ“ä½œ
1.mxGraphä¸­æœ‰ä¸‰ä¸ªä¸»è¦çš„ç»„ä»¶ï¼šmxGraphã€mxGraphModelã€mxCellã€‚mxGraphæ˜¯ç”¨æˆ·ç›´æ¥æ“ä½œçš„å›¾ï¼Œå›¾çš„æ‰€æœ‰çŠ¶æ€éƒ½ä¿å­˜åœ¨mxGraphModelä¸­ï¼Œè€Œå›¾ä¸­çš„é¡¶ç‚¹å’Œè¾¹éƒ½æ˜¯ç”¨mxCellå®šä¹‰ã€‚
2.å½“ç”¨æˆ·å¯¹mxGraphè¿›è¡Œæ“ä½œæ—¶ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜ å°„åˆ°å¯¹mxGraphModelä¸­ä¿å­˜çš„çŠ¶æ€è¿›è¡Œä¿®æ”¹ï¼Œè€ŒmxGraphModelä¸­ä¿å­˜çš„çŠ¶æ€ä¹Ÿå°±æ˜¯mxCellçš„çŠ¶æ€ã€‚

ä¸¾ä¸ªæœ€ç®€å•çš„ğŸŒ°
<html>
<head>
    <title>Hello, World! example for mxGraph</title>
    <!-- Sets the basepath for the library if not in same directory -->
    <script type="text/javascript">
        mxBasePath = '../src';
    </script>
    <!-- Loads and initializes the library -->
    <script type="text/javascript" src="../src/js/mxClient.js"></script>
    <!-- Example code -->
    <script type="text/javascript">
        
        function main(container)
        {
            // åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒ
            if (!mxClient.isBrowserSupported())
            {
                // mxUtilsæŠ¥é”™æç¤º
                mxUtils.error('Browser is not supported!', 200, false);
            }
            else
            {
                //å»é”¯é½¿æ•ˆæœ
                mxRectangleShape.prototype.crisp = true;
                // æ˜¾ç¤ºå¯¼èˆªçº¿ 
                mxGraphHandler.prototype.guidesEnabled = true;
                // Alté”®ç¦ç”¨å¯¼èˆªçº¿
                mxGuide.prototype.isEnabledForEvent = function (evt) {
                  return !mxEvent.isAltDown(evt);
                };
                // æ˜¾ç¤ºç»ˆç‚¹
                mxEdgeHandler.prototype.snapToTerminals = false;
                // ç¦ç”¨æµè§ˆå™¨é»˜è®¤çš„å³é”®èœå•æ 
                mxEvent.disableContextMenu(container);

                // åœ¨å·²æœ‰å®¹å™¨å†…æ„é€ ä¸€ä¸ªgraph
                var graph = new mxGraph(container);
                // é¼ æ ‡æ¡†é€‰ 
                new mxRubberband(graph);
                // åœ¨å›¾å½¢ä¸­åˆ›å»ºé»˜è®¤ç»„ä»¶ 
                var parent = graph.getDefaultParent();
                // åªå¯é¢„è§ˆä¸å¯é€‰ä¸­æ‹–åŠ¨è¿æ¥
                graph.setEnabled(false);  
                // å®¹å™¨å¤§å°è‡ªé€‚åº” 
                graph.setResizeContainer(true); 
                // åŠ¨æ€æ”¹å˜æ ·å¼ 
                graph.getView().updateStyle = true; 
                // å¯å¦é‡å¤è¿æ¥ 
                graph.setMultigraph(false); 
                // ç¦æ­¢æ”¹å˜å…ƒç´ å¤§å° 
                graph.setCellsResizable(false); 
                // å…è®¸è¿çº¿çš„ç›®æ ‡å’Œæºæ˜¯åŒä¸€å…ƒç´  
                graph.setAllowLoops(true); 

                // å¼€å§‹å¾€moduleé‡Œæ·»åŠ cell
                graph.getModel().beginUpdate();
                try
                {
                    //newä¸€ä¸ªcell   ä»¥å•å…ƒçš„å½¢å¼åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹
                    var cell = new mxCell(null, new mxGeometry(100, 200, 100, 100), "ä¸€äº›æ ·å¼é…ç½®");     
                    cell.vertex = true;
                    //æ’å…¥è¿™ä¸ªcell
                    graph.addCell(cell);
                 
                    var v1 = graph.insertVertex(parent, null, 'Hello,', 20, 20, 80, 30);
                    var v2 = graph.insertVertex(parent, null, 'World!', 200, 150, 80, 30);
                    //æ’å…¥çº¿æ¡è®¾ç½®è¿æ¥å›¾å½¢
                    var e1 = graph.insertEdge(parent, null, '', v1, v2);

                    //é¢„è§ˆæ—¶é¼ æ ‡æ‚¬æµ®åˆ°èŠ‚ç‚¹æ—¶ï¼Œæ”¹å˜é¼ æ ‡æ ·å¼
                    graph.getCursorForCell = function (cell) {
                      if (cell != null && cell.value != null && cell.vertex == 1) {
                         return 'pointer';
                      }
                    };
                }
                finally
                {
                    // æ›´æ–°äº‹åŠ¡ç»“æŸ
                    graph.getModel().endUpdate();
                }
            }
        };
    </script>
</head>

<!-- Page passes the container for the graph to the program -->
<body onload="main(document.getElementById('graphContainer'))">

    <!-- Creates a container for the graph with a grid wallpaper -->
    <div id="graphContainer"
        style="position:relative;overflow:hidden;width:321px;height:241px;background:url('editors/images/grid.gif');cursor:default;">
    </div>
</body>
</html>



1.äº‹ç‰©çš„æ›´æ–°ä¸€å®šè¦æ”¾åœ¨ beginUpdate å’Œ endUpdate é‡Œé¢ã€‚ä¸€æ¬¡ beginUpdate å¿…é¡»å¯¹åº”ä¸€æ¬¡ endUpdate

2.æ’å…¥cellæœ‰ä¸¤ç§æ–¹å¼ï¼š

new mxCell(null, new mxGeometry(100, 200, 100, 100))å’Œ
graph.insertVertex(parent, null, 'Hello,', 20, 20, 80, 30)
insertVertex åšäº†ä¸‰ä»¶äº‹ï¼Œå…ˆæ˜¯è®¾ç½®å‡ ä½•ä¿¡æ¯ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæœ€åå°†è¿™ä¸ªèŠ‚ç‚¹æ·»åŠ åˆ°ç”»å¸ƒã€‚insertEdge ä¸ insertVertex ç±»ä¼¼ï¼Œä¸­é—´è¿‡ç¨‹ä¼šè°ƒç”¨ vertex.setEdge(true) å°† Cell æ ‡è®°ä¸ºè¾¹ã€‚
å‡ ä½•ä¿¡æ¯å››ä¸ªæ•°å­—åˆ†åˆ«å¯¹åº” Xã€ Yã€ å®½ã€ é«˜   åæ ‡æ˜¯ä»¥graphçš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ã€‚

3.æœ€ä¸Šé¢æ˜¯é’ˆå¯¹å›¾åŒºåŸŸçš„ä¸€äº›è®¾ç½®
4.å¯¹æ’å…¥å…ƒç´ çš„æ ·å¼é…ç½®è·Ÿåœ¨mxCell()æœ€åé¢çš„å‚æ•°é‡Œï¼Œæ ·å¼å¯ä»¥æœ‰å¾ˆå¤šï¼Œåº“é‡Œä¹Ÿæä¾›äº†ä¸€äº›ã€‚å°±ä¸å¤šè¯´ï¼Œè¯´ä¸€ä¸‹è‡ªå®šä¹‰æ ·å¼ã€‚
          var style1 = [];
          style1[mxConstants.STYLE_SHAPE] = mxConstants.SHAPE_IMAGE;
          style1[mxConstants.STYLE_IMAGE] = './demoimg/å±å¹•å¿«ç…§ 2019-03-27 ä¸‹åˆ1.06.15.png';
          style1[mxConstants.STYLE_IMAGE_WIDTH] = '48';
          style1[mxConstants.STYLE_IMAGE_HEIGHT] = '48';
          graph.getStylesheet().putCellStyle('img1', style1);
          //æ’å…¥èŠ‚ç‚¹æ—¶å®šä¹‰æ ·å¼
          var cell1 = new mxCell(null, new mxGeometry(100, 200, 100, 100), "img1");

5.æ·»åŠ æŒ‰é’®
document.body.appendChild(mxUtils.button('value', function(evt){}

åˆ†è£…ä¸€ä¸ªåŠ¨æ€æ·»åŠ ä¸åŒåŠŸèƒ½çš„æŒ‰é’®çš„æ–¹æ³•

        // åˆ›å»ºæŒ‰é’®
  createButton = function (label, fun) {
    document.getElementById("btn").appendChild(mxUtils.button(label, fun));
  };

  buttons = [{
        label: "é€‰æ‹©æ‰€æœ‰",
        fun: function (graph) {
          return function (evt) {
            graph.selectAll();//graphæä¾›äº†å¾ˆå¤šçš„ä¸åŒæ–¹æ³•çš„API
          };
        }
      },
      {
         label: "åˆ é™¤",
         fun: function (graph) {
           return function (evt) {
             var cells = graph.getSelectionCells();
             graph.removeCells(cells);
           };
         }
       },
     ]

//å¾ªç¯æ·»åŠ æ‰€æœ‰è®¾ç½®å¥½åŠŸèƒ½çš„æŒ‰é’®
(function () {
  for (var i = 0; i < buttons.length; i++) {
    createButton(buttons[i].label, buttons[i].fun(graph));
  }
})();

6.è¯»å–Xml
var xml ="<root><mxCell id='2' value='Hello,' vertex='1'><mxGeometry x='20' y='20' width='80' height='30' as='geometry'/></mxCell><mxCell id='3' value='World!' vertex='1'><mxGeometry x='200' y='150' width='80' height='30' as='geometry'/></mxCell><mxCell id='4' value='' edge='1' source='2' target='3'><mxGeometry relative='1' as='geometry'/></mxCell></root>";
var doc = mxUtils.parseXml(xml);
var codec = new mxCodec(doc);
var elt = doc.documentElement.firstChild;
var cells = [];
while (elt != null) {
  cells.push(codec.decode(elt));
  elt = elt.nextSibling;
}
graph.addCells(cells);


7.å»ºç«‹æ‹–æ‹½å…³ç³»ï¼ˆé€‰å–æ‹–åŠ¨å®šç‚¹æ·»åŠ ï¼‰

// æ£€æŸ¥å›¾å½¢ä¸­æ˜¯å¦åŒ…å«å¯¹åº”çš„eltèŠ‚ç‚¹
        function containsElt(graph, elt) {
          while (elt != null) {
            if (elt == graph.container) {
              return true;
            }

            elt = elt.parentNode;
          }

          return false;
        };

        // è¿”å›é¼ æ ‡é€‰ä¸­çš„å…ƒç´ 
        var graphF = function (evt) {
          var x = mxEvent.getClientX(evt);
          var y = mxEvent.getClientY(evt);
          var elt = document.elementFromPoint(x, y);

          for (var i = 0; i < graphs.length; i++) {
            if (containsElt(graphs[i], elt)) {
              return graphs[i];
            }
          }

          return null;
        };

        // åœ¨ç»™å®šçš„ä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´  
        //mxCellæ˜¯é¡¶ç‚¹å’Œè¾¹çš„å•å…ƒå¯¹è±¡ï¼ŒmxCellä»æ¨¡å‹ï¼ˆmxGraphï¼‰é‚£é‡Œå¤åˆ¶äº†è®¸å¤šçš„æ–¹æ³•
        //å®ƒä»¬çš„ä¸»è¦å·®åˆ«åœ¨äºï¼Œä½¿ç”¨æ¨¡å‹çš„æ–¹æ³•ä¼šåˆ›å»ºç›¸å…³çš„äº‹ä»¶é€šçŸ¥ä»¥åŠæ’¤é”€æ–¹æ³•ï¼Œä½¿ç”¨å•å…ƒçš„æ–¹æ³•å¯ä»¥å‘ç”Ÿæ”¹å˜ä½†ä¸è®°å½•å®ƒä»¬
        var funct = function (graph, evt, target, x, y) {
          var cell = new mxCell('NewCELL', new mxGeometry(0, 0, 120, 40));
          cell.vertex = true;
          var cells = graph.importCells([cell], x, y, target); //æ’å…¥å…ƒç´ ã€ä½ç½®ã€å¤§å°

          if (cells != null && cells > 0) {
            graph.scrollCellToVisible(cells[0]);
            graph.setSelectionCells(cells);
          }
        };

        //åˆ›å»ºä¸€ä¸ªDOMèŠ‚ç‚¹ï¼Œä½œä¸ºæ‹–åŠ¨æº
        var img = mxUtils.createImage('images/icons48/gear.png');
        img.style.width = '48px';
        img.style.height = '48px';
        img.style.margin = '10px';
        document.getElementById("left").appendChild(img);

        // ç¦ç”¨IEæµè§ˆå™¨ä¸­çš„DnDåŠŸèƒ½ï¼ˆè¿™æ˜¯ä¸ºäº†è·¨æµè§ˆå™¨å¹³å°è€Œè®¾è®¡çš„ï¼Œè§ä¸‹æ–‡ï¼‰ 
        if (mxClient.IS_IE) {
          mxEvent.addListener(img, 'dragstart', function (evt) {
            evt.returnValue = false;
          });
        }

        // åˆ›å»ºæ‹–åŠ¨æºçš„é¢„è§ˆ
        var dragElt = document.createElement('div');
        dragElt.style.border = 'dashed black 1px';
        dragElt.style.width = '120px';
        dragElt.style.height = '40px';

        // åœ¨ç‚¹å‡»æ‹–åŠ¨æºå›¾æ ‡æ—¶æä¾›é¢„è§ˆã€‚ é¢„è§ˆæ˜¯æä¾›çš„ä»…ä»…æ˜¯æ‹–åŠ¨æºçš„å›¾ç‰‡
        // åªæœ‰æ‹–åŠ¨æºåˆ°å®¹å™¨å†…æ—¶æ‰ä¼šæ˜¾ç¤ºå…ƒç´ çš„åæ ‡é¢„è§ˆ

        var ds = mxUtils.makeDraggable(img, graphF, funct, dragElt, null, null, graph.autoscroll, true);

        //ä»æ‹–åŠ¨æºæ‹–åŠ¨æ—¶æ˜¾ç¤ºå¯¼èˆªçº¿ã€‚
        //æ³¨æ„ï¼Œå¯¹å›¾å½¢ä¸­å·²å­˜åœ¨çš„å…ƒç´ æ‹–åŠ¨æ—¶æ˜¾ç¤ºå¯¼èˆªçº¿ä¸åœ¨æœ¬æ–¹æ³•çº¦æŸèŒƒå›´ã€‚
        ds.isGuidesEnabled = function () {
          return graph.graphHandler.guidesEnabled;
        };

        //ä»æ‹–åŠ¨æºæ‹–åŠ¨å…ƒç´ åˆ°å›¾å½¢ä»¥å¤–çš„åŒºåŸŸæ—¶ï¼Œæ˜¾ç¤ºæ‹–åŠ¨æºå›¾ç‰‡é¢„è§ˆ
        ds.createDragElement = mxDragSource.prototype.createDragElement;


var ds = mxUtils.makeDraggable(img, graphF, funct, dragElt, null, null, graph.autoscroll, true);
makeDraggableçš„å‚æ•°makeDraggable( element,     graphF, funct, dragElement, dx, dy, autoscroll, scalePreview, highlightDropTargets, getDropTarget)
